{
    "advisory_record": {
        "cve_id": "CVE-2018-9856",
        "description": "Kotti before 1.3.2 and 2.x before 2.0.0b2 has CSRF in the local roles implementation, as demonstrated by triggering a permission change via a /admin-document/@@share request.",
        "reserved_timestamp": 1664755200,
        "published_timestamp": 1664814117,
        "updated_timestamp": 1664814117,
        "repository_url": null,
        "references": {
            "": 58,
            "https://github.com/Kotti/Kotti/issues/551": 3,
            "commit::69d3c8a5d7203ddaec5ced5901acf87baddd76be": 3,
            "https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax": 2,
            "https://github.com/features/actions": 1,
            "https://github.com/features/packages": 1,
            "https://github.com/features/security": 1,
            "https://github.com/features/codespaces": 1,
            "https://github.com/features/copilot": 1,
            "https://github.com/features/code-review": 1,
            "https://github.com/features/issues": 1,
            "https://github.com/features/discussions": 1,
            "https://github.com/features": 1,
            "https://docs.github.com": 1,
            "https://skills.github.com": 1,
            "https://github.blog": 1,
            "https://github.com/enterprise": 1,
            "https://github.com/team": 1,
            "https://github.com/enterprise/startups": 1,
            "https://github.com/solutions/industries/healthcare": 1,
            "https://github.com/solutions/industries/financial-services": 1,
            "https://github.com/solutions/industries/manufacturing": 1,
            "https://github.com/solutions/ci-cd": 1,
            "https://github.com/solutions/devops": 1,
            "https://github.com/solutions/devsecops": 1,
            "https://resources.github.com/learn/pathways": 1,
            "https://resources.github.com": 1,
            "https://github.com/customer-stories": 1,
            "https://partner.github.com": 1,
            "https://github.com/readme": 1,
            "https://github.com/topics": 1,
            "https://github.com/trending": 1,
            "https://github.com/collections": 1,
            "https://github.com/enterprise/advanced-security": 1,
            "https://github.com/pricing": 1,
            "https://docs.github.com/terms": 1,
            "https://docs.github.com/privacy": 1,
            "https://github.com/ehaoxiongdiycw": 1,
            "commit::00b56681fa9fb8587869a5e00dcd56503081d3b9": 1,
            "https://github.com": 1,
            "https://docs.github.com/site-policy/github-terms/github-terms-of-service": 1,
            "https://docs.github.com/site-policy/privacy-policies/github-privacy-statement": 1,
            "https://github.com/security": 1,
            "https://www.githubstatus.com/": 1,
            "https://docs.github.com/": 1,
            "https://support.github.com?tags=dotcom-footer": 1
        },
        "affected_products": [
            "n/a",
            "Kotti"
        ],
        "versions": {
            "status": "affected",
            "version": "n/a"
        },
        "files": [
            "CSRF"
        ],
        "keywords": [
            "trigger",
            "demonstrate",
            "permission",
            "role",
            "csrf",
            "implementation",
            "have",
            "request",
            "change",
            "kotti"
        ],
        "files_extension": [],
        "has_fixing_commit": true
    },
    "commits": [
        {
            "commit_id": "00b56681fa9fb8587869a5e00dcd56503081d3b9",
            "repository": "https://github.com/Kotti/Kotti",
            "timestamp": 1522753654,
            "hunks": 11,
            "message": "Fix #551.",
            "diff": [
                "diff --git a/kotti/templates/edit/share.pt b/kotti/templates/edit/share.pt",
                "index ff0d845c..2627e792 100644",
                "--- a/kotti/templates/edit/share.pt",
                "+++ b/kotti/templates/edit/share.pt",
                "@@ -41,2 +41,3 @@",
                "           id=\"form-share-assign\">",
                "+      <input type=\"hidden\" name=\"csrf_token\" value=\"${csrf_token}\">",
                "diff --git a/kotti/templates/login.pt b/kotti/templates/login.pt",
                "index e70c029d..ed9a0ddc 100644",
                "--- a/kotti/templates/login.pt",
                "+++ b/kotti/templates/login.pt",
                "@@ -19,5 +19,5 @@",
                "             <div class=\"control-group\">",
                "-              <label class=\"control-label\" for=\"form-login\"",
                "+              <label class=\"control-label\" for=\"form-login-login\"",
                "                      i18n:translate=\"\">Username or email</label>",
                "-              <input type=\"text\" name=\"login\" id=\"form-login\"",
                "+              <input type=\"text\" name=\"login\" id=\"form-login-login\"",
                "                      class=\"form-control\" value=\"${login}\" />",
                "@@ -57,5 +57,5 @@",
                "             <div class=\"control-group\">",
                "-              <label class=\"control-label\" for=\"form-login\"",
                "+              <label class=\"control-label\" for=\"form-forgot-password-login\"",
                "                      i18n:translate=\"\">Username or email</label>",
                "-              <input type=\"text\" name=\"login\" id=\"form-login\"",
                "+              <input type=\"text\" name=\"login\" id=\"form-forgot-password-login\"",
                "                      class=\"form-control\" value=\"${login}\" />",
                "diff --git a/kotti/tests/test_node_views.py b/kotti/tests/test_node_views.py",
                "index bceab28d..575a94f2 100644",
                "--- a/kotti/tests/test_node_views.py",
                "+++ b/kotti/tests/test_node_views.py",
                "@@ -1,2 +1,3 @@",
                " from pyramid.exceptions import Forbidden",
                "+from pyramid.httpexceptions import HTTPBadRequest",
                " from pytest import raises",
                "@@ -434,2 +435,3 @@ class TestNodeShare:",
                "         request.params['apply'] = ''",
                "+        request.params['csrf_token'] = request.session.get_csrf_token()",
                "         share_node(root, request)",
                "@@ -462 +464,17 @@ class TestNodeShare:",
                "             )",
                "+",
                "+    def test_csrf(self, extra_principals, root, dummy_request):",
                "+        \"\"\" Test if a CSRF token is present and checked on submission \"\"\"",
                "+        from kotti.views.users import share_node",
                "+",
                "+        result = share_node(root, dummy_request)",
                "+        assert 'csrf_token' in result",
                "+",
                "+        dummy_request.params['apply'] = ''",
                "+",
                "+        with raises(HTTPBadRequest):",
                "+            share_node(root, dummy_request)",
                "+",
                "+        dummy_request.params['csrf_token'] = dummy_request.session.get_csrf_token()  # noqa",
                "+        result = share_node(root, dummy_request)",
                "+        assert result['csrf_token'] == dummy_request.session.get_csrf_token()",
                "diff --git a/kotti/views/users.py b/kotti/views/users.py",
                "index ce667c74..8a83ce78 100644",
                "--- a/kotti/views/users.py",
                "+++ b/kotti/views/users.py",
                "@@ -11,3 +11,3 @@ from deform.widget import SequenceWidget",
                " from pyramid.exceptions import Forbidden",
                "-from pyramid.httpexceptions import HTTPFound",
                "+from pyramid.httpexceptions import HTTPFound, HTTPBadRequest",
                " from pyramid.view import view_config",
                "@@ -111,2 +111,5 @@ def share_node(context, request):",
                "     # Allow roles_form_handler to do processing on 'apply':",
                "+    if 'apply' in request.POST:",
                "+        if request.params.get('csrf_token') != request.session.get_csrf_token():",
                "+            raise HTTPBadRequest('Invalid CSRF token')",
                "     changed = roles_form_handler(",
                "@@ -134,2 +137,3 @@ def share_node(context, request):",
                "         'available_roles': available_roles,",
                "+        'csrf_token': request.session.get_csrf_token()",
                "         }"
            ],
            "changed_files": [
                "kotti/templates/edit/share.pt",
                "kotti/templates/login.pt",
                "kotti/tests/test_node_views.py",
                "kotti/views/users.py"
            ],
            "message_reference_content": [],
            "jira_refs": {},
            "ghissue_refs": {
                "551": ""
            },
            "cve_refs": [],
            "twins": [],
            "tags": [
                "1.3.2",
                "2.0.0",
                "2.0.0b2",
                "2.0.1",
                "2.0.2",
                "2.0.3",
                "2.0.4",
                "2.0.5",
                "2.0.6",
                "2.0.7",
                "2.0.8",
                "2.0.9"
            ],
            "matched_rules": [
                {
                    "id": "XREF_GH",
                    "message": "The commit and the advisory (including referenced pages) mention the same github issue: 551",
                    "relevance": 32
                },
                {
                    "id": "COMMIT_IN_REFERENCE",
                    "message": "This commit is mentioned 1 times in the references.",
                    "relevance": 64
                },
                {
                    "id": "CHANGES_RELEVANT_CODE",
                    "message": "The commit modifies code containing relevant filename or methods: CSRF",
                    "relevance": 8
                },
                {
                    "id": "ADV_KEYWORDS_IN_FILES",
                    "message": "An advisory keyword is contained in the changed files: kotti",
                    "relevance": 4
                },
                {
                    "id": "GITHUB_ISSUE_IN_MESSAGE",
                    "message": "The commit message references some github issue: 551",
                    "relevance": 2
                }
            ]
        },
        {
            "commit_id": "69d3c8a5d7203ddaec5ced5901acf87baddd76be",
            "repository": "https://github.com/Kotti/Kotti",
            "timestamp": 1522844557,
            "hunks": 13,
            "message": "Backport fix for #551 from master.",
            "diff": [
                "diff --cc kotti/tests/__init__.py",
                "index 7b4f3e91,b8879d78..73018675",
                "--- a/kotti/tests/__init__.py",
                "+++ b/kotti/tests/__init__.py",
                "@@@ -160,3 -155,3 +160,3 @@@ def connection(custom_settings)",
                "--@fixture(scope='session')",
                "++@fixture",
                "  def content(connection, settings):",
                "@@@ -164,7 -159,7 +164,15 @@@",
                "      \"\"\"",
                "--    from transaction import commit",
                "++    import transaction",
                "++    from kotti import DBSession",
                "      from kotti import metadata",
                "      from kotti.resources import get_root",
                "++",
                "++    if connection.in_transaction():",
                "++        transaction.abort()",
                "++    DBSession().close()",
                "++",
                "      metadata.drop_all(connection.engine)",
                "++    transaction.begin()",
                "      metadata.create_all(connection.engine)",
                "++",
                "      # to create the default content with the correct workflow state",
                "@@@ -182,4 -177,4 +190,4 @@@",
                "      # otherwise:",
                " -    get_root().path = '/'",
                " -    commit()",
                " +    get_root().path = u'/'",
                "-     commit()",
                "++    transaction.commit()",
                "diff --cc kotti/tests/test_node_views.py",
                "index 2ce4823a,575a94f2..304c648a",
                "--- a/kotti/tests/test_node_views.py",
                "+++ b/kotti/tests/test_node_views.py",
                "@@@ -432,3 -434,4 +433,4 @@@ class TestNodeShare",
                " -        request.params['apply'] = ''",
                " +        request.params['apply'] = u''",
                "+         request.params['csrf_token'] = request.session.get_csrf_token()",
                "          share_node(root, request)",
                "@@@ -461,1 -464,17 +463,17 @@@",
                "              )",
                "+ ",
                "+     def test_csrf(self, extra_principals, root, dummy_request):",
                "+         \"\"\" Test if a CSRF token is present and checked on submission \"\"\"",
                "+         from kotti.views.users import share_node",
                "+ ",
                "+         result = share_node(root, dummy_request)",
                "+         assert 'csrf_token' in result",
                "+ ",
                " -        dummy_request.params['apply'] = ''",
                "++        dummy_request.params['apply'] = u''",
                "+ ",
                "+         with raises(HTTPBadRequest):",
                "+             share_node(root, dummy_request)",
                "+ ",
                "+         dummy_request.params['csrf_token'] = dummy_request.session.get_csrf_token()  # noqa",
                "+         result = share_node(root, dummy_request)",
                "+         assert result['csrf_token'] == dummy_request.session.get_csrf_token()",
                "diff --cc setup.py",
                "index d6440e9e,ec55720d..5f2f279d",
                "--- a/setup.py",
                "+++ b/setup.py",
                "@@@ -8,4 -6,3 +8,4 @@@ from setuptools import setu",
                " -version = '2.0.0b1'",
                " +",
                "- version = '1.3.1'",
                "++version = '1.3.2.dev0'",
                "  description = \"A high-level, Pythonic web application framework based on \" \\",
                "@@@ -33,2 -30,3 +33,3 @@@ install_requires = ",
                "      'html2text',",
                " -    'iso8601==0.1.11',  # rq.filter: !=0.1.12",
                "++    'iso8601<=0.1.11',",
                "      'js.angular',",
                "@@@ -38,3 -36,3 +39,3 @@@",
                "      'js.html5shiv',",
                "-     'js.jquery',",
                " -    'js.jquery<2.0.0.dev',  # rq.filter: <2.0",
                "++    'js.jquery<2.0.0',",
                "      'js.jquery_form',"
            ],
            "changed_files": [],
            "message_reference_content": [],
            "jira_refs": {},
            "ghissue_refs": {
                "551": ""
            },
            "cve_refs": [],
            "twins": [],
            "tags": [
                "1.3.2"
            ],
            "matched_rules": [
                {
                    "id": "XREF_GH",
                    "message": "The commit and the advisory (including referenced pages) mention the same github issue: 551",
                    "relevance": 32
                },
                {
                    "id": "COMMIT_IN_REFERENCE",
                    "message": "This commit is mentioned 3 times in the references.",
                    "relevance": 64
                },
                {
                    "id": "CHANGES_RELEVANT_CODE",
                    "message": "The commit modifies code containing relevant filename or methods: CSRF",
                    "relevance": 8
                },
                {
                    "id": "GITHUB_ISSUE_IN_MESSAGE",
                    "message": "The commit message references some github issue: 551",
                    "relevance": 2
                }
            ]
        },
        {
            "commit_id": "aa2b62075be841c8bb217f5c01aa44f9d7cc43dc",
            "repository": "https://github.com/Kotti/Kotti",
            "timestamp": 1522753880,
            "hunks": 4,
            "message": "Merge branch 'hotfix/2.0.0b2' # Conflicts: #\tCHANGES.txt #\trequirements.txt #\tsetup.py",
            "diff": [
                "diff --cc CHANGES.txt",
                "index 5ab0a68a,35a265fa..84a25929",
                "--- a/CHANGES.txt",
                "+++ b/CHANGES.txt",
                "@@@ -3,7 -3,7 +3,12 @@@ Change Histor",
                "- 2.0.0b2.dev0 - unreleased",
                "++2.0.0b3.dev0 - unreleased",
                " +-------------------------",
                " +",
                " +- No changes yet.",
                " +",
                "+ 2.0.0b2 - 2018-04-03",
                "+ --------------------",
                "+ ",
                "+ - Fix CSRF issue in ``@@share`` view (#551).",
                "+ ",
                "  2.0.0b1 - 2018-03-19",
                "diff --cc setup.py",
                "index 77fcc67f,e86bf442..f2dd1a27",
                "--- a/setup.py",
                "+++ b/setup.py",
                "@@@ -6,3 -6,3 +6,3 @@@ from setuptools import setu",
                "- version = '2.0.0b2.dev0'",
                " -version = '2.0.0b2'",
                "++version = '2.0.0b3.dev0'",
                "  description = \"A high-level, Pythonic web application framework based on \" \\"
            ],
            "changed_files": [],
            "message_reference_content": [],
            "jira_refs": {},
            "ghissue_refs": {},
            "cve_refs": [],
            "twins": [],
            "tags": [
                "2.0.0",
                "2.0.0b2",
                "2.0.1",
                "2.0.2",
                "2.0.3",
                "2.0.4",
                "2.0.5",
                "2.0.6",
                "2.0.7",
                "2.0.8",
                "2.0.9"
            ],
            "matched_rules": [
                {
                    "id": "CHANGES_RELEVANT_CODE",
                    "message": "The commit modifies code containing relevant filename or methods: CSRF",
                    "relevance": 8
                },
                {
                    "id": "ADV_KEYWORDS_IN_MSG",
                    "message": "The commit message and the advisory description contain the following keywords: change",
                    "relevance": 4
                }
            ]
        },
        {
            "commit_id": "eb3e0d9f28e86e8812e3216a85d25490e1d6872b",
            "repository": "https://github.com/Kotti/Kotti",
            "timestamp": 1522835492,
            "hunks": 3,
            "message": "Fix sorting issue on mysql.",
            "diff": [
                "diff --git a/kotti/tests/test_tags.py b/kotti/tests/test_tags.py",
                "index 8fcd23a5..e447dae9 100644",
                "--- a/kotti/tests/test_tags.py",
                "+++ b/kotti/tests/test_tags.py",
                "@@ -224,7 +224,7 @@ class TestTags:",
                "         result = content_with_tags(['first tag'])",
                "-        assert [res.name for res in result] == ['folder_1', 'content_2']",
                "+        assert sorted([res.name for res in result]) == sorted(['folder_1', 'content_2'])",
                "         result = content_with_tags(['second tag'])",
                "-        assert [res.name for res in result] == ['folder_1']",
                "+        assert sorted([res.name for res in result]) == sorted(['folder_1'])",
                "         result = content_with_tags(['third tag'])",
                "-        assert [res.name for res in result] == ['content_1', 'content_2']",
                "+        assert sorted([res.name for res in result]) == sorted(['content_1', 'content_2'])"
            ],
            "changed_files": [
                "kotti/tests/test_tags.py"
            ],
            "message_reference_content": [],
            "jira_refs": {},
            "ghissue_refs": {},
            "cve_refs": [],
            "twins": [
                [
                    "no-tag",
                    "668431056e293a7c9a1562fb42d3eb2af8b4b144"
                ]
            ],
            "tags": [
                "2.0.0",
                "2.0.0b2",
                "2.0.1",
                "2.0.2",
                "2.0.3",
                "2.0.4",
                "2.0.5",
                "2.0.6",
                "2.0.7",
                "2.0.8",
                "2.0.9"
            ],
            "matched_rules": [
                {
                    "id": "ADV_KEYWORDS_IN_FILES",
                    "message": "An advisory keyword is contained in the changed files: kotti",
                    "relevance": 4
                },
                {
                    "id": "COMMIT_HAS_TWINS",
                    "message": "This commit has one or more twins.",
                    "relevance": 2
                }
            ]
        },
        {
            "commit_id": "e4f8b70fa0a63ac11d240be50bfd1317e89be6e8",
            "repository": "https://github.com/Kotti/Kotti",
            "timestamp": 1522765397,
            "hunks": 1,
            "message": "Remove erroneous fixture scope.",
            "diff": [
                "diff --git a/kotti/tests/__init__.py b/kotti/tests/__init__.py",
                "index b8879d78..e2ad39a8 100644",
                "--- a/kotti/tests/__init__.py",
                "+++ b/kotti/tests/__init__.py",
                "@@ -155,3 +155,3 @@ def connection(custom_settings):",
                "-@fixture(scope='session')",
                "+@fixture",
                " def content(connection, settings):"
            ],
            "changed_files": [
                "kotti/tests/__init__.py"
            ],
            "message_reference_content": [],
            "jira_refs": {},
            "ghissue_refs": {},
            "cve_refs": [],
            "twins": [],
            "tags": [
                "2.0.0",
                "2.0.0b2",
                "2.0.1",
                "2.0.2",
                "2.0.3",
                "2.0.4",
                "2.0.5",
                "2.0.6",
                "2.0.7",
                "2.0.8",
                "2.0.9"
            ],
            "matched_rules": [
                {
                    "id": "ADV_KEYWORDS_IN_FILES",
                    "message": "An advisory keyword is contained in the changed files: kotti",
                    "relevance": 4
                }
            ]
        },
        {
            "commit_id": "c99116eaf204d319f9ea091fa0951a149c69d19e",
            "repository": "https://github.com/Kotti/Kotti",
            "timestamp": 1522753611,
            "hunks": 8,
            "message": "Move workflow action related stuff to separate test to prevent random test failures.",
            "diff": [
                "diff --git a/kotti/tests/test_functional.py b/kotti/tests/test_functional.py",
                "index 21333bbf..0d7a4de8 100644",
                "--- a/kotti/tests/test_functional.py",
                "+++ b/kotti/tests/test_functional.py",
                "@@ -564,11 +564,72 @@ class TestBrowser:",
                "+        # Navigation",
                "+        resp = resp.click(\"Navigate\")",
                "+        resp = resp.click(\"Second Child\", index=0)",
                "+        assert resp.request.path == '/second-child-1/'",
                "+",
                "+    @pytest.mark.user('admin')",
                "+    def test_workflow_actions(self, webtest):",
                "+",
                "+        app = webtest.app",
                "+",
                "+        # Add a document",
                "+        resp = app.get('/')",
                "+        resp = resp.click('Document', index=0)",
                "+        form = resp.forms['deform']",
                "+        form['title'] = \"Child One\"",
                "+        resp = form.submit('save').maybe_follow()",
                "+        assert \"Item was added\" in resp.text",
                "+        assert resp.request.path == '/child-one/'",
                "+",
                "+        # Add more documents",
                "+        resp = app.get('/')",
                "+        resp = resp.click('Document', index=0)",
                "+        form = resp.forms['deform']",
                "+        form['title'] = \"Second Child\"",
                "+        resp = form.submit('save').maybe_follow()",
                "+        assert resp.request.path == '/second-child/'",
                "+",
                "+        resp = resp.click('Document', index=0)",
                "+        form = resp.forms['deform']",
                "+        form['title'] = \"Third Child\"",
                "+        resp = form.submit('save').maybe_follow()",
                "+        assert resp.request.path == '/second-child/third-child/'",
                "+",
                "+        resp = app.get('/second-child/third-child/')",
                "+        resp = resp.click('Document', index=0)",
                "+        form = resp.forms['deform']",
                "+        form['title'] = \"Grandchild 1\"",
                "+        resp = form.submit('save').maybe_follow()",
                "+        assert resp.request.path == '/second-child/third-child/grandchild-1/'",
                "+",
                "+        resp = app.get('/second-child/third-child/')",
                "+        resp = resp.click('Document', index=0)",
                "+        form = resp.forms['deform']",
                "+        form['title'] = \"Grandchild 2\"",
                "+        resp = form.submit('save').maybe_follow()",
                "+        assert resp.request.path == '/second-child/third-child/grandchild-2/'",
                "+",
                "+        resp = app.get('/second-child/third-child/')",
                "+        resp = resp.click('Document', index=0)",
                "+        form = resp.forms['deform']",
                "+        form['title'] = \"Grandchild 3\"",
                "+        resp = form.submit('save').maybe_follow()",
                "+        assert resp.request.path == '/second-child/third-child/grandchild-3/'",
                "+",
                "+        resp = app.get('/second-child/third-child/')",
                "+        resp = resp.click('Document', index=0)",
                "+        form = resp.forms['deform']",
                "+        form['title'] = \"Child One\"",
                "+        resp = form.submit('save').maybe_follow()",
                "+        assert resp.request.path == '/second-child/third-child/child-one/'",
                "+",
                "         # Contents view change state actions (workflow)",
                "-        resp = resp.click(\"Second Child\")",
                "+        resp = resp.click(\"Second Child\", index=0)",
                "         resp = resp.click(\"Contents\")",
                "-        assert '/second-child-1/third-child/@@workflow-change?new_state=public' in resp.text  # noqa",
                "+        assert '/second-child/third-child/@@workflow-change?new_state=public' in resp.text  # noqa",
                "-        resp = app.get('/second-child-1/third-child/@@workflow-change?new_state=public').maybe_follow()  # noqa",
                "-        assert '/second-child-1/third-child/@@workflow-change?new_state=private' in resp.text  # noqa",
                "+        resp = app.get('/second-child/third-child/@@workflow-change?new_state=public').maybe_follow()  # noqa",
                "+        assert '/second-child/third-child/@@workflow-change?new_state=private' in resp.text  # noqa",
                "-        resp = app.get('/second-child-1/third-child/@@contents')",
                "+        resp = app.get('/second-child/third-child/@@contents')",
                "         form = self._select_children(resp, 0, 1, 2)",
                "@@ -579,3 +640,3 @@ class TestBrowser:",
                "         assert 'No changes were made.' in resp.text",
                "-        assert resp.request.path == '/second-child-1/third-child/@@contents'",
                "+        assert resp.request.path == '/second-child/third-child/@@contents'",
                "@@ -594,14 +655,14 @@ class TestBrowser:",
                "         assert 'Your changes have been saved.' in resp.text",
                "-        assert '/second-child-1/third-child/grandchild-1/@@workflow-change?new_state=private' in resp.text  # noqa",
                "-        assert '/second-child-1/third-child/grandchild-2/@@workflow-change?new_state=private' in resp.text  # noqa",
                "-        assert '/second-child-1/third-child/grandchild-3/@@workflow-change?new_state=private' in resp.text  # noqa",
                "+        assert '/second-child/third-child/grandchild-1/@@workflow-change?new_state=private' in resp.text  # noqa",
                "+        assert '/second-child/third-child/grandchild-2/@@workflow-change?new_state=private' in resp.text  # noqa",
                "+        assert '/second-child/third-child/grandchild-3/@@workflow-change?new_state=private' in resp.text  # noqa",
                "-        resp = resp.click('My Third Child')",
                "-        assert '/second-child-1/third-child/child-one/@@workflow-change?new_state=public' in resp.text  # noqa",
                "+        resp = resp.click('Child One', index=1)",
                "+        assert '/second-child/third-child/child-one/@@workflow-change?new_state=public' in resp.text  # noqa",
                "-        app.get('/second-child-1/third-child/child-one/@@workflow-change?new_state=public')  # noqa",
                "-        resp = app.get('/second-child-1/third-child/@@contents')",
                "-        assert '/second-child-1/third-child/child-one/@@workflow-change?new_state=private' in resp.text  # noqa",
                "+        app.get('/second-child/third-child/child-one/@@workflow-change?new_state=public')  # noqa",
                "+        resp = app.get('/second-child/third-child/@@contents')",
                "+        assert '/second-child/third-child/child-one/@@workflow-change?new_state=private' in resp.text  # noqa",
                "-        resp = resp.click('First Child', index=1)",
                "+        resp = resp.click('Child One', index=1)",
                "         resp = resp.click('Document', index=0)",
                "@@ -610,7 +671,8 @@ class TestBrowser:",
                "         resp = form.submit('save').maybe_follow()",
                "-        assert '/second-child-1/third-child/child-one/sub-child/@@workflow-change?new_state=public' in resp.text  # noqa",
                "+        assert '/second-child/third-child/child-one/sub-child/@@workflow-change?new_state=public' in resp.text  # noqa",
                "-        resp = resp.click(\"Second Child\", index=0)",
                "-        resp = resp.click(\"Contents\")",
                "-        form = self._select_children(resp, 0, 1, 2)",
                "+        resp = resp.click('Second Child', index=0)",
                "+        resp = resp.click('Contents')",
                "+",
                "+        form = self._select_children(resp, 0)",
                "         resp = form.submit('change_state').maybe_follow()",
                "@@ -618,14 +680,9 @@ class TestBrowser:",
                "         form['include-children'] = 'include-children'",
                "-        form['to-state'] = 'public'",
                "+        form['to-state'] = 'private'",
                "         resp = form.submit('change_state').maybe_follow()",
                "         assert 'Your changes have been saved.' in resp.text",
                "-        assert '/second-child-1/third-child/@@workflow-change?new_state=private' in resp.text  # noqa",
                "+        assert '/second-child/third-child/@@workflow-change?new_state=public' in resp.text  # noqa",
                "-        resp = app.get('/second-child-1/third-child/child-one/sub-child/')",
                "-        assert '/second-child-1/third-child/child-one/sub-child/@@workflow-change?new_state=private' in resp.text  # noqa",
                "-",
                "-        # Navigation",
                "-        resp = resp.click(\"Navigate\")",
                "-        resp = resp.click(\"Second Child\", index=0)",
                "-        assert resp.request.path == '/second-child-1/'",
                "+        resp = app.get('/second-child/third-child/child-one/sub-child/')",
                "+        assert '/second-child/third-child/child-one/sub-child/@@workflow-change?new_state=public' in resp.text  # noqa"
            ],
            "changed_files": [
                "kotti/tests/test_functional.py"
            ],
            "message_reference_content": [],
            "jira_refs": {},
            "ghissue_refs": {},
            "cve_refs": [],
            "twins": [],
            "tags": [
                "1.3.2",
                "2.0.0",
                "2.0.0b2",
                "2.0.1",
                "2.0.2",
                "2.0.3",
                "2.0.4",
                "2.0.5",
                "2.0.6",
                "2.0.7",
                "2.0.8",
                "2.0.9"
            ],
            "matched_rules": [
                {
                    "id": "ADV_KEYWORDS_IN_FILES",
                    "message": "An advisory keyword is contained in the changed files: kotti",
                    "relevance": 4
                }
            ]
        },
        {
            "commit_id": "236eaa8f5112a611d8e5c90fa0217429bc35631c",
            "repository": "https://github.com/Kotti/Kotti",
            "timestamp": 1522832252,
            "hunks": 6,
            "message": "Abort transactions and explicitly close ``DBSession`` in ``content`` fixture to prevent hanging test suite when using PostgreSQL or MySQL. Install psycopg2-binary on CI services.",
            "diff": [
                "diff --git a/.circleci/config.yml b/.circleci/config.yml",
                "index e780dcf4..3806a278 100644",
                "--- a/.circleci/config.yml",
                "+++ b/.circleci/config.yml",
                "@@ -30,3 +30,3 @@ jobs:",
                "             pip install -U pip wheel setuptools setuptools-git",
                "-            pip install psycopg2 mysqlclient python-coveralls codecov",
                "+            pip install psycopg2-binary mysqlclient python-coveralls codecov",
                "             pip install -e .[testing]",
                "diff --git a/.travis.yml b/.travis.yml",
                "index 8afde245..aa0deabd 100644",
                "--- a/.travis.yml",
                "+++ b/.travis.yml",
                "@@ -17,3 +17,3 @@ install:",
                "   - travis_retry pip install -U pip wheel setuptools",
                "-  - travis_retry pip install psycopg2 mysqlclient python-coveralls codecov",
                "+  - travis_retry pip install psycopg2-binary mysqlclient python-coveralls codecov",
                "   - travis_retry pip install -e \".[testing]\"",
                "diff --git a/kotti/tests/__init__.py b/kotti/tests/__init__.py",
                "index e2ad39a8..605faae3 100644",
                "--- a/kotti/tests/__init__.py",
                "+++ b/kotti/tests/__init__.py",
                "@@ -159,5 +159,11 @@ def content(connection, settings):",
                "     \"\"\"",
                "-    from transaction import commit",
                "+    import transaction",
                "+    from kotti import DBSession",
                "     from kotti import metadata",
                "     from kotti.resources import get_root",
                "+",
                "+    if connection.in_transaction():",
                "+        transaction.abort()",
                "+    DBSession().close()",
                "+",
                "     metadata.drop_all(connection.engine)",
                "@@ -178,3 +184,3 @@ def content(connection, settings):",
                "     get_root().path = '/'",
                "-    commit()",
                "+    transaction.commit()",
                "diff --git a/setup.py b/setup.py",
                "index f2dd1a27..d7b7b993 100644",
                "--- a/setup.py",
                "+++ b/setup.py",
                "@@ -6,3 +6,3 @@ from setuptools import setup",
                "-version = '2.0.0b3.dev0'",
                "+version = '2.0.0b3.dev1'",
                " description = \"A high-level, Pythonic web application framework based on \" \\"
            ],
            "changed_files": [
                ".circleci/config.yml",
                ".travis.yml",
                "kotti/tests/__init__.py",
                "setup.py"
            ],
            "message_reference_content": [],
            "jira_refs": {},
            "ghissue_refs": {},
            "cve_refs": [],
            "twins": [],
            "tags": [
                "2.0.0",
                "2.0.0b2",
                "2.0.1",
                "2.0.2",
                "2.0.3",
                "2.0.4",
                "2.0.5",
                "2.0.6",
                "2.0.7",
                "2.0.8",
                "2.0.9"
            ],
            "matched_rules": [
                {
                    "id": "ADV_KEYWORDS_IN_FILES",
                    "message": "An advisory keyword is contained in the changed files: kotti",
                    "relevance": 4
                }
            ]
        },
        {
            "commit_id": "1136d756b037ad7c5b6fb7cd82a3f0818116c6c5",
            "repository": "https://github.com/Kotti/Kotti",
            "timestamp": 1522834555,
            "hunks": 1,
            "message": "Always begin a new transaction.",
            "diff": [
                "diff --git a/kotti/tests/__init__.py b/kotti/tests/__init__.py",
                "index 605faae3..39d4f25f 100644",
                "--- a/kotti/tests/__init__.py",
                "+++ b/kotti/tests/__init__.py",
                "@@ -169,2 +169,3 @@ def content(connection, settings):",
                "     metadata.drop_all(connection.engine)",
                "+    transaction.begin()",
                "     metadata.create_all(connection.engine)"
            ],
            "changed_files": [
                "kotti/tests/__init__.py"
            ],
            "message_reference_content": [],
            "jira_refs": {},
            "ghissue_refs": {},
            "cve_refs": [],
            "twins": [],
            "tags": [
                "2.0.0",
                "2.0.0b2",
                "2.0.1",
                "2.0.2",
                "2.0.3",
                "2.0.4",
                "2.0.5",
                "2.0.6",
                "2.0.7",
                "2.0.8",
                "2.0.9"
            ],
            "matched_rules": [
                {
                    "id": "ADV_KEYWORDS_IN_FILES",
                    "message": "An advisory keyword is contained in the changed files: kotti",
                    "relevance": 4
                }
            ]
        },
        {
            "commit_id": "2ab79c9ef68341bd9c742d6187ee1b326b972223",
            "repository": "https://github.com/Kotti/Kotti",
            "timestamp": 1522846042,
            "hunks": 1,
            "message": "Bump version.",
            "diff": [
                "diff --git a/setup.py b/setup.py",
                "index d7b7b993..e86bf442 100644",
                "--- a/setup.py",
                "+++ b/setup.py",
                "@@ -6,3 +6,3 @@ from setuptools import setup",
                "-version = '2.0.0b3.dev1'",
                "+version = '2.0.0b2'",
                " description = \"A high-level, Pythonic web application framework based on \" \\"
            ],
            "changed_files": [
                "setup.py"
            ],
            "message_reference_content": [],
            "jira_refs": {},
            "ghissue_refs": {},
            "cve_refs": [],
            "twins": [
                [
                    "no-tag",
                    "9c99ba3f9b4a9e10cd31317d7d467409f9f98805"
                ],
                [
                    "no-tag",
                    "ae48d1d6e7332a544dd1ef75372e0a1ddbde0de4"
                ],
                [
                    "no-tag",
                    "779aeca58abe9159fab78f799ee409cd5283449c"
                ],
                [
                    "no-tag",
                    "2323a2b382d6af85d7b2701210fc8166bcbc2dad"
                ]
            ],
            "tags": [
                "2.0.0",
                "2.0.0b2",
                "2.0.1",
                "2.0.2",
                "2.0.3",
                "2.0.4",
                "2.0.5",
                "2.0.6",
                "2.0.7",
                "2.0.8",
                "2.0.9"
            ],
            "matched_rules": [
                {
                    "id": "COMMIT_HAS_TWINS",
                    "message": "This commit has one or more twins.",
                    "relevance": 2
                }
            ]
        },
        {
            "commit_id": "879a5e967cc1951357e418a99d1d9b6edfe2206e",
            "repository": "https://github.com/Kotti/Kotti",
            "timestamp": 1523257568,
            "hunks": 1,
            "message": "Fix #552.",
            "diff": [
                "diff --git a/app.ini b/app.ini",
                "index 0198c406..f6c0b22f 100644",
                "--- a/app.ini",
                "+++ b/app.ini",
                "@@ -22,3 +22,4 @@ mail.default_sender = yourname@yourhost",
                " kotti.configurators =",
                "-  kotti_tinymce.kotti_configure",
                "+# kotti_tinymce is optional in Kotti 2.x",
                "+#  kotti_tinymce.kotti_configure",
                " # kotti_image was part of kotti in 1.x."
            ],
            "changed_files": [
                "app.ini"
            ],
            "message_reference_content": [],
            "jira_refs": {},
            "ghissue_refs": {
                "552": ""
            },
            "cve_refs": [],
            "twins": [],
            "tags": [
                "2.0.0",
                "2.0.1",
                "2.0.2",
                "2.0.3",
                "2.0.4",
                "2.0.5",
                "2.0.6",
                "2.0.7",
                "2.0.8",
                "2.0.9"
            ],
            "matched_rules": [
                {
                    "id": "GITHUB_ISSUE_IN_MESSAGE",
                    "message": "The commit message references some github issue: 552",
                    "relevance": 2
                }
            ]
        },
        {
            "commit_id": "99efd778ce53444f426f11747ced6a009266f290",
            "repository": "https://github.com/Kotti/Kotti",
            "timestamp": 1522846054,
            "hunks": 0,
            "message": "Merge branch 'release/2.0.0b2'",
            "diff": [],
            "changed_files": [],
            "message_reference_content": [],
            "jira_refs": {},
            "ghissue_refs": {},
            "cve_refs": [],
            "twins": [],
            "tags": [
                "2.0.0",
                "2.0.1",
                "2.0.2",
                "2.0.3",
                "2.0.4",
                "2.0.5",
                "2.0.6",
                "2.0.7",
                "2.0.8",
                "2.0.9"
            ],
            "matched_rules": []
        },
        {
            "commit_id": "0a565eba9c503e1a2da981610580d2e4d7299c72",
            "repository": "https://github.com/Kotti/Kotti",
            "timestamp": 1522753752,
            "hunks": 0,
            "message": "Merge branch 'hotfix/2.0.0b2' into testing",
            "diff": [],
            "changed_files": [],
            "message_reference_content": [],
            "jira_refs": {},
            "ghissue_refs": {},
            "cve_refs": [],
            "twins": [],
            "tags": [
                "2.0.0",
                "2.0.0b2",
                "2.0.1",
                "2.0.2",
                "2.0.3",
                "2.0.4",
                "2.0.5",
                "2.0.6",
                "2.0.7",
                "2.0.8",
                "2.0.9"
            ],
            "matched_rules": []
        },
        {
            "commit_id": "1726491d481fc32dde74030b69690b7c84653157",
            "repository": "https://github.com/Kotti/Kotti",
            "timestamp": 1522846054,
            "hunks": 0,
            "message": "Merge branch 'release/2.0.0b2' into testing",
            "diff": [],
            "changed_files": [],
            "message_reference_content": [],
            "jira_refs": {},
            "ghissue_refs": {},
            "cve_refs": [],
            "twins": [],
            "tags": [
                "2.0.0",
                "2.0.0b2",
                "2.0.1",
                "2.0.2",
                "2.0.3",
                "2.0.4",
                "2.0.5",
                "2.0.6",
                "2.0.7",
                "2.0.8",
                "2.0.9"
            ],
            "matched_rules": []
        },
        {
            "commit_id": "de16d2bc3c6e39909dc5a3e9bac1174c2a9813bc",
            "repository": "https://github.com/Kotti/Kotti",
            "timestamp": 1522753533,
            "hunks": 2,
            "message": "Update requirements.",
            "diff": [
                "diff --git a/setup.py b/setup.py",
                "index b6939766..ec55720d 100644",
                "--- a/setup.py",
                "+++ b/setup.py",
                "@@ -33,3 +33,3 @@ install_requires = [",
                "     'js.bootstrap>=3.0.0',",
                "-    'js.deform>=2.0a2-2',",
                "+    'js.deform>=2.0.3',",
                "     'js.fineuploader',",
                "@@ -86,2 +86,3 @@ development_requires = [",
                "     'pyramid_debugtoolbar',",
                "+    'kotti-tinymce>=0.7.0',",
                " ]"
            ],
            "changed_files": [
                "setup.py"
            ],
            "message_reference_content": [],
            "jira_refs": {},
            "ghissue_refs": {},
            "cve_refs": [],
            "twins": [],
            "tags": [
                "1.3.2",
                "2.0.0",
                "2.0.0b2",
                "2.0.1",
                "2.0.2",
                "2.0.3",
                "2.0.4",
                "2.0.5",
                "2.0.6",
                "2.0.7",
                "2.0.8",
                "2.0.9"
            ],
            "matched_rules": []
        }
    ]
}
